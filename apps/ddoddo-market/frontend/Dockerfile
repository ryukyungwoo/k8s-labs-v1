FROM node:18-alpine
WORKDIR /app

# 1) 빌드 아규먼트 정의
ARG NEXT_PUBLIC_SUPABASE_URL
ARG NEXT_PUBLIC_SUPABASE_ANON_KEY
ARG NEXT_PUBLIC_API_BASE_URL

# 2) 빌드 환경변수로 설정
ENV NEXT_PUBLIC_SUPABASE_URL=${NEXT_PUBLIC_SUPABASE_URL}
ENV NEXT_PUBLIC_SUPABASE_ANON_KEY=${NEXT_PUBLIC_SUPABASE_ANON_KEY}
ENV NEXT_PUBLIC_API_BASE_URL=${NEXT_PUBLIC_API_BASE_URL}

# 3) 종속성 설치
COPY package*.json ./
RUN npm install

# 4) 소스 복사 & 빌드
COPY . .
RUN npm run build

# 5) 앱 실행
CMD ["npm", "start"]
