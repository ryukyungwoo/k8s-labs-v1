# Lab 01: `todo-list`에 Ingress 적용하기

`exercises`를 통해 우리는 Ingress의 강력한 라우팅 기능을 배웠습니다. 이제 우리의 첫 번째 프로젝트인 `todo-list`에 Ingress를 직접 적용하여, 여러 서비스로 흩어져 있던 진입점을 하나로 통합하는 실전 훈련을 시작하겠습니다.

현재 `todo-list`의 백엔드와 프론트엔드는 각각 별도의 서비스(`NodePort` 또는 `LoadBalancer`)를 통해 외부에 노출되어 있습니다. 이번 랩의 목표는 이 두 서비스를 **단 하나의 Ingress** 뒤로 배치하여, URL 경로에 따라 트래픽을 지능적으로 분배하는 것입니다.

---

### 🎯 미션 (Your Mission)

1.  `todo-list`의 백엔드와 프론트엔드 서비스를 단일 Ingress를 통해 외부에 노출하세요.
2.  최종적으로 사용자는 **하나의 IP 주소**로만 접속해야 합니다.
    - `/api/` 로 시작하는 모든 요청은 백엔드 서비스로 전달되어야 합니다.
    - 그 외의 모든 요청은 프론트엔드 서비스로 전달되어야 합니다.
3.  `lab01` 디렉토리 안에 `todo-list-ingress.yaml` 파일을 직접 작성하여 미션을 완료해야 합니다.

---

### 💡 문제 해결을 위한 힌트 (Hints)

#### **1. 서비스 타입 변경이 첫걸음!**

- 가장 먼저, 기존에 만들었던 `todo-backend-svc.yaml`과 `todo-frontend-svc.yaml` 파일을 찾아 `type`을 **`ClusterIP`**로 변경하고 다시 적용(`kubectl apply`)해야 합니다.
- 왜냐하면 이제 외부 트래픽 관리는 오직 Ingress의 책임이며, 서비스들은 클러스터 내부에서만 통신하면 되기 때문입니다.

#### **2. Ingress Manifest 작성 (`todo-list-ingress.yaml`)**

- `exercises/ex03`에서 만들었던 `ingress.yaml` 파일의 구조를 참고하면 큰 도움이 됩니다.
- **규칙의 순서가 중요합니다!** 더 구체적인 경로인 `/api` 규칙을 일반적인 경로인 `/` 규칙보다 **먼저** 작성해야 Ingress가 올바르게 해석합니다.
- **`rewrite-target` 어노테이션을 잊지 마세요.** 백엔드 API 서버는 `/api/todos` 라는 전체 경로가 아니라, `/todos` 라는 경로로 요청이 들어올 것으로 예상할 가능성이 높습니다. `/api` 부분을 지워주기 위해 `nginx.ingress.kubernetes.io/rewrite-target` 어노테이션을 `/api` 경로 규칙에 어떻게 적용해야 할지 고민해 보세요.
  - `/api` 경로에 대한 규칙에는 `rewrite-target: /` 과 비슷한 설정이 필요할 수 있습니다.
  - `/` 경로(프론트엔드) 규칙에는 이 어노테이션이 필요 없습니다.

#### **3. 테스트는 `minikube tunnel`과 함께**

- 규칙 작성을 마쳤다면, Docker 드라이버 환경에서 외부 접속을 위해 **별도의 터미널에서 `minikube tunnel`을 실행**하는 것을 잊지 마세요.

---

### ✅ 검증 방법 (Verification)

모든 설정을 마쳤다면, 아래 방법으로 직접 검증해 보세요.

1.  **리소스 생성 확인:**

    - `kubectl get ingress` 명령어로 여러분이 만든 Ingress 리소스가 정상적으로 생성되었는지 확인하세요. `ADDRESS`가 표시되어야 합니다.

2.  **`minikube tunnel` 실행:**

    - 별도의 터미널에서 `minikube tunnel`을 실행하고 띄워 둡니다.

3.  **API 서버 테스트 (백엔드 라우팅 확인):**

    - `curl http://127.0.0.1:8000/api/todos` 명령어를 실행했을 때, JSON 형태의 할 일 목록 (비어있더라도 `[]` 형태)이 반환되어야 합니다. 404 에러가 발생하면 안 됩니다.

4.  **웹 애플리케이션 테스트 (프론트엔드 라우팅 확인):**
    - 웹 브라우저에서 `http://127.0.0.1:8000` 주소로 접속합니다.
    - `todo-list`의 프론트엔드 화면이 정상적으로 보여야 합니다.
    - 새로운 할 일을 추가하고, 목록에 잘 나타나는지 확인하며 모든 기능이 완벽하게 동작하는지 최종 테스트합니다.
